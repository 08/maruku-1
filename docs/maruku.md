CSS: style.css
LaTeX_use_listings: false
html_use_syntax: true
use_numbered_headers: true

{ruby}:     lang=ruby code_background_color='#efffef'
{shell}:    lang=shell code_background_color='#efefff'
{markdown}: lang=markdown code_background_color='#ffefef'


Mar**u**k**u**: a Markdown-superset interpreter 
===============================================

[Maruku][] is a Markdown interpreter written in [Ruby][].

Maruku allows you to write in an easy-to-read-and-write syntax, like this:

> [This document in Markdown][this_md] 

Then it can be translated to HTML:

> [This document in HTML][this_html]
	
or LaTeX, which is then converted to PDF:

> [This document in PDF][this_pdf]

Maruku implements:

* the original [Markdown syntax][markdown_html] ([HTML][markdown_html] or
  [PDF][markdown_pdf]), translated by Maruku).

* all the improvements in [PHP Markdown Extra][]. 

* a new [meta-data syntax][meta]


__Authors__: Maruku has been developed so far by [Andrea Censi][].
Contributors are most welcome!

__The name of the game__: Maruku is the [romaji][] translitteration of 
the [katakana][] translitteration
of "Mark", the first word in Markdown. I chose this name because Ruby 
is Japanese, and also the sillable "ru" appears in Maruku.

[romaji]: http://en.wikipedia.org/wiki/Romaji
[katakana]: http://en.wikipedia.org/wiki/Katakana

[tests]: http://maruku.rubyforge.org/tests/
[maruku]: <http://maruku.rubyforge.org/>
[markdown_html]: http://maruku.rubyforge.org/markdown_syntax.html
[markdown_pdf]: http://maruku.rubyforge.org/markdown_syntax.pdf
[this_md]: http://maruku.rubyforge.org/maruku.md
[this_html]: http://maruku.rubyforge.org/maruku.html
[this_pdf]: http://maruku.rubyforge.org/maruku.pdf
[Andrea Censi]: http://www.dis.uniroma1.it/~acensi/

* * *

Table of contents: (**auto-generated by Maruku!**)

* This list will contain the toc (it doesn't matter what you write here)
{toc}

* * *

Release notes  {#release_notes}
--------------

Note: Maruku seems to be very robust, nevertheless it is still beta-level
software. So if you want to use it in production environments, please 
check back in a month or so, while we squash the remaining bugs.

In the meantime, feel free to toy around, and please signal problems,
request features, by [contacting me][contact] or using the [tracker][tracker]. 
For issues about the Markdown syntax itself and improvements to it, 
please write to the [Markdown-discuss mailing list][markdown-discuss].

Have fun!

#### Changes in 0.4 ####

* First implementation of [the new meta-data syntax][meta].
* General refactorization of the code and much cleaner error reporting.
* Created [the RDOC documentation][rdoc].
* The `add_whitespace` method took too much time -- it was O(n^2).
* Added unit-tests for block-level elements.

[rdoc]: http://maruku.rubyforge.org/rdoc/
[meta]: http://maruku.rubyforge.org/proposal.html

#### Changes in 0.3 ####

*	A real parser is used instead of a regexp-based system, also for span-level 
	elements.

	Now Maruku is almost 2x faster than Bluecloth, while having more features.

	Here are some benchmarks:
	
		BlueCloth (to_html): parsing 0.00 sec + rendering 1.54 sec = 1.55 sec 
		Maruku (to_html):    parsing 0.47 sec + rendering 0.38 sec = 0.85 sec 
		Maruku (to_latex):   parsing 0.49 sec + rendering 0.25 sec = 0.73 sec
		
	This is the result of running `lib/maruku/tests/benchmark.rb` on the Markdown 
	specification.

*	Prettier HTML output by adding whitespace.
 
*	Added a full suite of unit-tests for the span-level parser.

*	Error management: Having a real parser, Maruku warns you about syntax issues.
	
	The default action is to warn and try to continue. If you do this:

		Maruku.new(string, {:on_error => :raise})

	then syntax errors will cause an exception to be raised (you can catch this
	and retry).

*	Fixed a series of bugs in handling inline HTML code.

Immediate TODO-list:

*	UTF-8 input/output works OK for HTML, however I am having pain trying to export
	to LaTeX. I want at least Japanese characters support, so if you know how to 
	do this you are very welcome to give me an hand.
	
	For example: in the HTML version, you should see accented characters in this
	parenthesis: 
	
	> (àèìòù)
	
	and Japanese text in these other parentheses: 
	
	> (カタカナで 私の 名前は アンドレア チェンシ です).
	>
	> (日本のガルは 大好き、でも、日本語は難しですから、そうぞ 英語話すガルを おしえてください).
	
	In the LaTeX version, these do not appear. I know how to do LaTeX with 
	ISO-8859-1 encoding (European characters), but I'm struggling with half-baked 
	solutions for UTF-8 encoded documents.

*	Implement the [new meta-data proposal][proposal].

*	Exporting to Markdown (pretty printing).

*	Exporting to HTML splitting in multiple files.

*	RubyPants.

*	Support for images in PDF.


[proposal]: http://maruku.rubyforge.org/proposal.html
[contact]: http://www.dis.uniroma1.it/~acensi/contact.html
[markdown-discuss]: http://six.pairlist.net/mailman/listinfo/markdown-discuss
[tracker]: http://rubyforge.org/tracker/?group_id=2795

Download       {#download}
--------

The development site is <http://rubyforge.org/projects/maruku/>.

Install with:

	$ gem install maruku

  {shell}

Released files can also be seen at <http://rubyforge.org/frs/?group_id=2795>.

Anonymous access to the repository is possible with:

	$ svn checkout svn://rubyforge.org/var/svn/maruku

  {shell}

If you want commit access to the repository, just create an account on Rubyforge and [drop me a mail][drop].

[drop]: http://www.dis.uniroma1.it/~acensi/contact.html
[gem]: http://rubygems.rubyforge.org/

### Bugs report ###

Use the [tracker][tracker] or [drop me an email][drop].

[tracker]: http://rubyforge.org/tracker/?group_id=2795

Usage
--------

This is the basic usage:

	require 'rubygems'
	require 'maruku'

	doc = Maruku.new(markdown_string)
	puts doc.to_html

  {ruby}

The method `to_html` outputs only an HTML fragment, while the method `to_html_document` outputs a complete XHTML 1.0 document:

	puts doc.to_html_document

  {ruby}
	
You can have the REXML document tree with:

	tree = doc.to_html_document_tree

  {ruby}

### From the command line ###

There are two command-line programs installed: `maruku` and `marutex`.

*	`maruku` converts Markdown to HTML:

		$ maruku file.md  # creates file.html
	{shell}

* 	`marutex` converts Markdown to LaTeX, then calls `pdflatex` to 
	transform to PDF:

		$ marutex file.md  # creates file.tex and file.pdf
	{shell}


Examples of PHP Markdown Extra syntax {#extra}
-------------------------------------

*	tables

		Col1 | Very very long head | Very very long head|
		-----|:-------------------:|-------------------:|
		cell | center-align        | right-align        |
	{markdown}

	Col1 | Very very long head | Very very long head|
	-----|:-------------------:|-------------------:|
	cell | center-align        | right-align        |


*	footnotes [^foot]

		* footnotes [^foot]
	
		[^foot]: I really was missing those.
	{markdown}

[^foot]: I really was missing those.

*	Markdown inside HTML elements

		<div markdown="1" style="border: solid 1px black">
		   This is a div with Markdown **strong text**
		</div>
	  {html}

	<div markdown="1" style="border: solid 1px black">
	   This is a div with Markdown **strong text**
	</div>


*	header ids

		## Download ##     {#download}
	{markdown}

	For example, [a link to the download](#download) header.


*	definition lists

		Definition list
		: something very hard to parse
	{markdown}

	Definition list
	: something very hard to parse

*	abbreviations or ABB for short.

*[ABB]: Simply an abbreviation



Maruku and Bluecloth          {#maruku-and-bluecloth}
--------------------

The other Ruby implementation of Markdown is [Bluecloth][]. 

Maruku is much different in philosophy from Bluecloth: the biggest 
difference is that *parsing* is separated from *rendering*.
In Maruku, an in-memory representation of the Markdown
document is created. Instead, Bluecloth mantains the document in
memory as a String at all times, and does a series of `gsub` 
to transform to HTML.

The in-memory representation makes it very easy to export
to various formats (at the moment HTML and LaTeX/PDF; 
the next is pretty-printed Markdown).

Other improvements over Bluecloth:

* the HTML output is provided also as a `REXML` document tree.

* PHP Markdown Syntax support.

[ruby]: http://www.ruby-lang.org
[bluecloth]: http://www.deveiate.org/projects/BlueCloth
[Markdown syntax]: http://daringfireball.net/projects/markdown/syntax
[PHP Markdown Extra]: http://www.michelf.com/projects/php-markdown/extra/


New meta-data syntax {#meta}
--------------------

Maruku implements a syntax that allows to attach "meta" information
to objects.

### Meta-data for block-level and span-level elements ###

See [this proposal][meta].

### Meta-data for the document ###

Meta-data for the document itself is specified through the use
of email headers:

	Title: A simple document containing meta-headers
	CSS: style.css
	
	Content of the document

  {markdown}

When creating the document through 

	Maruku.new(s).to_html_document

  {ruby}

the title and stylesheet are added as expected.

Meta-data keys are assumed to be case-insensitive.


* * *


### List of meta-data  ###    {#metalist}

[listings]: http://www.ctan.org/tex-archive/macros/latex/contrib/listings/

**`title`, `subject`**
: (document) Sets the title of the document (HTML: used in the `TITLE` element).

**`use_numbered_headers`**
: (document) If `true`, headers are numbered (just like this document). Default is `false`.

**`css`**
: (document, HTML) Url of stylesheet.

**`html_use_syntax`**
: (document, HTML) If set, use the [Ruby `syntax` library][syntax] to add source highlighting.

**`latex_use_listings`**
: (document, LaTeX) If set, use the fancy [`listings` package][listings] for better displaying code blocks.
     
     If not set,  use standard `verbatim` environment.

**`style`, `id`, `class`**
: (any block object, HTML) Standard CSS attributes are copied.

**`lang`**
: (code blocks) Name of programming language (`ruby`) for syntax highlighting.

      Default for this is `code_lang` in document.
      
      Syntax highlighting is delegated to the [`syntax` library][syntax] for
      HTML output and to the [`listings` package][listings] for LaTeX output.


**`code_show_spaces`**
: Shows tabs and newlines (default is read in the document object).

**`code_background_color`**
: Background color for code blocks. (default is read in the document object).

    The format is either a named color (`green`, `red`) or a CSS color
    of the form `#ff00ff`. 

    * for **HTML output**, the value is put straight in the `background-color` CSS 
      property of the block.

    * for **LaTeX output**, if it is a named color, it must be a color accepted
      by the LaTeX `color` packages. If it is of the form `#ff00ff`, Maruku
      defines a color using the `\color[rgb]{r,g,b}` macro. 

      For example, for `#0000ff`, the macro is called as: `\color[rgb]{0,0,1}`.

[syntax]: http://syntax.rubyforge.org/


### Examples ###

An example of this is the following:

		 One space
		  Two spaces
			 	Tab, space, tab
					Tab, tab, tab and all is green!
	{code_show_spaces code_background_color=#ffeedd}
{markdown}
	
That will produce:

	 One space
	  Two spaces
		 	Tab, space, tab
				Tab, tab, tab and all is green!
{code_show_spaces code_background_color=#ffeedd}


Or highlighting (support depends on languages):

		<div style="text-align:center">Div</div>
	{lang=html}

produces:

	<div style="text-align:center">Div</div>
{lang=html}



* * *

Other Features      {#features}
--------------

### Automatic generation of the table of contents ###

If you create a list, and then set the `toc` attribute, when rendering
Maruku will create an auto-generated table of contents.

	* This will become a table of contents (this text will be scraped).
	{toc}

You can see an example of this at the beginning of this document.

### This header contains *emphasis* **strong text** and `code` ####

Note that this header contains formatting and it still works, also in the table of contents.

And [This is a *link* with **all** ***sort*** of `weird stuff`](#features) in the text.

### Use HTML entities ###

If you want to use HTML entities, go on! We will take care
of the translation to LaTeX:

Entity      | Result
------------|----------
`&copy;`    |  &copy;
`&pound;`   |  &pound;
`a&nbsp;b`  |  a&nbsp;b
`&lambda;`  |  &lambda;
`&mdash;`   |  &mdash;




Future developments                              {#future}
-------------------

I think that [Pandoc][] and [MultiMarkdown][] are very cool projects.
However, they are written in Haskell and Perl, respectively. 
I would love to have an equivalent in Ruby.

[Pandoc]: http://sophos.berkeley.edu/macfarlane/pandoc/
[MultiMarkdown]: http://fletcher.freeshell.org/wiki/MultiMarkdown


### A syntax for adding math ###

Something inspired from LaTeX should be familiar to all:

	This is inline math: $\alpha$


	This is an equation with label:

	$ \alpha = \beta + \gamma  $        (eq:1)

	This is a reference to equation: please see (eq:1)


